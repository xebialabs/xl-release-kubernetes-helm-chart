{{- if .Values.postgresql.install }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-release-postgresql
  namespace: {{ include "common.names.namespace" . | quote }}
  labels: {{- include "common.labels.standard" . | nindent 4 }}
    {{- if .Values.commonLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.commonLabels "context" $ ) | nindent 4 }}
    {{- end }}
  {{- if or .Values.serviceAccount.annotations .Values.commonAnnotations }}
  annotations:
    {{- if .Values.commonAnnotations }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.commonAnnotations "context" $ ) | nindent 4 }}
    {{- end }}
    {{- if .Values.serviceAccount.annotations }}
    {{- include "common.tplvalues.render" (dict "value" .Values.serviceAccount.annotations "context" $) | nindent 4 }}
    {{- end }}
  {{- end }}
type: Opaque
stringData:
  init.sql: |
    CREATE USER "xlr" WITH ENCRYPTED PASSWORD 'xlr';
    CREATE DATABASE "xlr-db";
    GRANT ALL PRIVILEGES ON DATABASE "xlr-db" TO "xlr";
    CREATE USER "xlr-report" WITH ENCRYPTED PASSWORD 'xlr-report';
    CREATE DATABASE "xlr-report-db";
    GRANT ALL PRIVILEGES ON DATABASE "xlr-report-db" TO "xlr-report";
    CREATE USER "keycloak" WITH ENCRYPTED PASSWORD 'keycloak';
    CREATE DATABASE "keycloak";
    GRANT ALL PRIVILEGES ON DATABASE "keycloak" TO "keycloak";
{{- end }}
